<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trinity Orchestration Workspace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 16px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f85032 0%, #e73827 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            color: #333;
            font-weight: 500;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.2s;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .status-display {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
        }

        .status-display pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .instance-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .instance-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }

        .instance-item.active {
            border-left-color: #38ef7d;
            background: #e8f5e9;
        }

        .task-item {
            background: #fff3cd;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 4px solid #ffc107;
        }

        .task-item.completed {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .task-item.in-progress {
            background: #cfe2ff;
            border-left-color: #0d6efd;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box .number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .stat-box .label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .log-entry {
            padding: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-entry .timestamp {
            color: #666;
            font-size: 0.85em;
        }

        #autoRefresh {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî± TRINITY ORCHESTRATION</h1>
            <p>Autonomous Multi-Claude Coordination System</p>
        </div>

        <div class="grid">
            <!-- System Status Card -->
            <div class="card">
                <h2>üìä System Status</h2>
                <div class="stats">
                    <div class="stat-box">
                        <div class="number" id="totalMessages">0</div>
                        <div class="label">Messages</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="activeTasks">0</div>
                        <div class="label">Active</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="completedTasks">0</div>
                        <div class="label">Done</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="totalOutputs">0</div>
                        <div class="label">Outputs</div>
                    </div>
                </div>
                <button class="btn" onclick="refreshStatus()">üîÑ Refresh Status</button>
                <label>
                    <input type="checkbox" id="autoRefresh" onchange="toggleAutoRefresh()">
                    Auto-refresh (5s)
                </label>
                <div id="statusDisplay" class="status-display"></div>
            </div>

            <!-- Broadcast Message Card -->
            <div class="card">
                <h2>üì¢ Broadcast Message</h2>
                <div class="input-group">
                    <label>Message to All Instances:</label>
                    <textarea id="broadcastMessage" placeholder="Enter message to broadcast to all Claude instances..."></textarea>
                </div>
                <div class="input-group">
                    <label>From:</label>
                    <input type="text" id="broadcastFrom" placeholder="coordinator" value="coordinator">
                </div>
                <button class="btn" onclick="sendBroadcast()">üì° Send Broadcast</button>
            </div>

            <!-- Assign Task Card -->
            <div class="card">
                <h2>üìã Assign Task</h2>
                <div class="input-group">
                    <label>Task Description:</label>
                    <textarea id="taskDescription" placeholder="Describe the task..."></textarea>
                </div>
                <div class="input-group">
                    <label>Assign To:</label>
                    <select id="assignTo">
                        <option value="any">Any Available Instance</option>
                        <option value="claude-code-main">Claude Code (Terminal)</option>
                        <option value="claude-desktop">Claude Desktop</option>
                        <option value="claude-cloud-1">Cloud Instance 1</option>
                        <option value="claude-cloud-2">Cloud Instance 2</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Priority:</label>
                    <select id="taskPriority">
                        <option value="normal">Normal</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <button class="btn" onclick="assignTask()">‚ûï Assign Task</button>
            </div>

            <!-- Quick Actions Card -->
            <div class="card">
                <h2>‚ö° Quick Actions</h2>
                <button class="btn btn-success" onclick="startAutonomousMode()">üöÄ Start Autonomous Mode</button>
                <button class="btn" onclick="wakeAllInstances()">‚è∞ Wake All Instances</button>
                <button class="btn" onclick="mergeOutputs()">üîó Merge All Outputs</button>
                <button class="btn btn-danger" onclick="clearAll()">üóëÔ∏è Clear All Data</button>
            </div>
        </div>

        <!-- Task Queue Section -->
        <div class="card">
            <h2>üìù Task Queue</h2>
            <div id="taskQueue"></div>
        </div>

        <!-- Activity Log Section -->
        <div class="card">
            <h2>üìú Activity Log</h2>
            <div id="activityLog" class="status-display"></div>
        </div>
    </div>

    <script>
        let autoRefreshInterval = null;
        let activityLog = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            activityLog.unshift({ timestamp, message });
            if (activityLog.length > 50) activityLog.pop();
            updateActivityLog();
        }

        function updateActivityLog() {
            const logDiv = document.getElementById('activityLog');
            logDiv.innerHTML = activityLog.map(entry => `
                <div class="log-entry">
                    <span class="timestamp">[${entry.timestamp}]</span> ${entry.message}
                </div>
            `).join('');
        }

        async function callTrinityAPI(tool, args) {
            // This would call the actual MCP server through Claude
            // For now, simulate with localStorage
            log(`üîß Called ${tool} with args: ${JSON.stringify(args)}`);
            
            // In production, this would be:
            // const response = await claudeAPI.callTool(tool, args);
            // return response;
            
            return { success: true, message: `${tool} executed` };
        }

        async function refreshStatus() {
            log('üîÑ Refreshing status...');
            
            // Read from .trinity folder files
            try {
                const status = await callTrinityAPI('trinity_status', {});
                
                // Update stats
                document.getElementById('totalMessages').textContent = status.messages?.total || 0;
                document.getElementById('activeTasks').textContent = status.tasks?.active || 0;
                document.getElementById('completedTasks').textContent = status.tasks?.completed || 0;
                document.getElementById('totalOutputs').textContent = status.outputs?.total || 0;
                
                // Display full status
                document.getElementById('statusDisplay').innerHTML = `<pre>${JSON.stringify(status, null, 2)}</pre>`;
                
                log('‚úÖ Status refreshed');
            } catch (error) {
                log(`‚ùå Error refreshing status: ${error.message}`);
            }
        }

        async function sendBroadcast() {
            const message = document.getElementById('broadcastMessage').value;
            const from = document.getElementById('broadcastFrom').value;
            
            if (!message) {
                alert('Please enter a message');
                return;
            }
            
            log(`üì¢ Broadcasting: "${message}"`);
            
            await callTrinityAPI('trinity_broadcast', { message, from });
            
            document.getElementById('broadcastMessage').value = '';
            log('‚úÖ Broadcast sent to all instances');
        }

        async function assignTask() {
            const task = document.getElementById('taskDescription').value;
            const assignedTo = document.getElementById('assignTo').value;
            const priority = document.getElementById('taskPriority').value;
            
            if (!task) {
                alert('Please enter a task description');
                return;
            }
            
            log(`üìã Assigning task to ${assignedTo}: "${task}"`);
            
            await callTrinityAPI('trinity_assign_task', { task, assignedTo, priority });
            
            document.getElementById('taskDescription').value = '';
            log(`‚úÖ Task assigned (priority: ${priority})`);
            refreshStatus();
        }

        async function wakeAllInstances() {
            log('‚è∞ Waking all instances...');
            
            const instances = ['claude-code-main', 'claude-desktop', 'claude-cloud-1', 'claude-cloud-2'];
            
            for (const instance of instances) {
                await callTrinityAPI('trinity_wake_instance', { 
                    instanceId: instance, 
                    reason: 'Coordinator wake-up call' 
                });
            }
            
            log('‚úÖ Wake signals sent to all instances');
        }

        async function mergeOutputs() {
            log('üîó Merging all outputs...');
            
            const result = await callTrinityAPI('trinity_merge_outputs', { 
                projectName: 'Trinity Orchestration' 
            });
            
            log('‚úÖ Outputs merged into single summary');
            
            // Display merged summary
            alert('Outputs merged! Check the status display for details.');
            refreshStatus();
        }

        async function startAutonomousMode() {
            log('üöÄ Starting autonomous mode...');
            
            // Broadcast to all instances to start autonomous work
            await callTrinityAPI('trinity_broadcast', {
                message: 'AUTONOMOUS MODE ACTIVATED - Check for tasks and begin work',
                from: 'coordinator'
            });
            
            // Assign some initial tasks
            const tasks = [
                'Research latest AI developments',
                'Analyze system performance',
                'Generate progress report'
            ];
            
            for (const task of tasks) {
                await callTrinityAPI('trinity_assign_task', {
                    task,
                    assignedTo: 'any',
                    priority: 'high'
                });
            }
            
            log('‚úÖ Autonomous mode activated - instances will begin work');
            refreshStatus();
        }

        function toggleAutoRefresh() {
            const enabled = document.getElementById('autoRefresh').checked;
            
            if (enabled) {
                autoRefreshInterval = setInterval(refreshStatus, 5000);
                log('üîÑ Auto-refresh enabled (5s interval)');
            } else {
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
                log('‚è∏Ô∏è Auto-refresh disabled');
            }
        }

        async function clearAll() {
            if (!confirm('Are you sure you want to clear all Trinity data? This cannot be undone.')) {
                return;
            }
            
            log('üóëÔ∏è Clearing all data...');
            
            // In production, would call API to clear files
            log('‚ö†Ô∏è Manual file deletion required: .trinity/messages.json, tasks.json, outputs.json');
            
            refreshStatus();
        }

        // Initialize on load
        window.onload = () => {
            log('üî± Trinity Orchestration Workspace initialized');
            refreshStatus();
        };
    </script>
</body>
</html>
